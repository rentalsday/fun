<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Budget Vibes ‚Ä¢ $ ‚Üí Fun</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
      color: #f0f0ff;
      min-height: 100vh;
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
      box-sizing: border-box;
    }
    h1 {
      font-size: clamp(2.5rem, 8vw, 3.5rem);
      margin: 0.5rem 0 0.8rem;
      background: linear-gradient(90deg, #a78bfa, #7dd3fc);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .input-area {
      display: flex;
      gap: 1rem;
      margin: 1.5rem 0 2rem;
      width: 100%;
      max-width: 500px;
      justify-content: center;
    }
    input {
      font-size: clamp(1.8rem, 6vw, 2.2rem);
      width: 160px;
      padding: 0.7rem 1rem;
      border: 2px solid #6b7280;
      border-radius: 12px;
      background: #1e1b38;
      color: white;
      text-align: center;
    }
    button {
      font-size: clamp(1.3rem, 5vw, 1.6rem);
      padding: 0.8rem 2rem;
      border: none;
      border-radius: 12px;
      background: #7c3aed;
      color: white;
      cursor: pointer;
      transition: all 0.2s;
    }
    button:hover { background: #9f7aea; transform: translateY(-2px); }
    
    #result {
      max-width: 700px;
      background: rgba(30, 27, 56, 0.75);
      backdrop-filter: blur(8px);
      padding: 1.8rem 2rem;
      border-radius: 16px;
      line-height: 1.6;
      font-size: clamp(1.1rem, 4vw, 1.3rem);
      border: 1px solid #4b5563;
      min-height: 160px;
      white-space: pre-wrap;
      text-align: left;
    }
    
    .emoji { font-size: 1.8rem; margin-right: 0.4rem; }

    @media (max-width: 600px) {
      body { padding: 1.5rem 1rem; }
      .input-area { flex-direction: column; align-items: center; gap: 1rem; }
      input, button { width: 80%; max-width: 300px; }
    }
  </style>
</head>
<body>

  <h1>Budget Vibes</h1>
  <p style="opacity:0.8; margin-top:-0.8rem; text-align:center;">Turn any dollar amount into instant fun ideas</p>

  <div class="input-area">
    <input type="number" id="budget" placeholder="50" min="1" step="1" autofocus>
    <button onclick="generateIdeas()">Go!</button>
  </div>

  <div id="result">Enter an amount above and hit Go! ‚ú®<br><small>Local Berkeley/Bay Area vibes coming right up...</small></div>

  <script>
    const resultDiv = document.getElementById('result');
    const input = document.getElementById('budget');

    let userLocation = "Berkeley, California, US"; // Default fallback

    // Try to get more precise location via browser (non-blocking)
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(async (pos) => {
        try {
          const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${pos.coords.latitude}&lon=${pos.coords.longitude}&zoom=10&addressdetails=1`);
          const data = await res.json();
          const city = data.address?.city || data.address?.town || data.address?.village || '';
          const state = data.address?.state || '';
          const country = data.address?.country_code?.toUpperCase() || '';
          if (city && state) {
            userLocation = `${city}, ${state} ${country}`.trim();
          }
        } catch (err) {
          console.log('Location fetch failed, using default');
        }
      }, () => {}, { timeout: 5000 });
    }

    input.addEventListener('keypress', e => {
      if (e.key === 'Enter') generateIdeas();
    });

    async function generateIdeas() {
      const dollars = parseInt(input.value) || 0;
      if (dollars < 1) {
        resultDiv.innerHTML = "üí∏ Give me at least <strong>$1</strong> to work with...";
        return;
      }

      resultDiv.innerHTML = "Brewing some üî• local vibes... one sec ‚è≥";

      try {
        const response = await fetch("/api/proxy", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            model: "grok-beta",  // Change to a newer model if available (check xAI docs)
            messages: [
              {
                role: "system",
                content: `You are a super fun, creative, slightly chaotic friend in ${userLocation}. 
                Turn any budget into exciting, realistic things to do today or this weekend ‚Äî food, activities, experiences, cheap thrills, etc.
                Use lots of emojis. Give 4‚Äì6 specific ideas. Sort roughly from cheapest ‚Üí most expensive (but all ‚â§ budget).
                Include one mildly unhinged / legendary suggestion. Tailor heavily to Berkeley / Bay Area / California vibes (outdoor stuff, food trucks, hikes, techy events, campus life, etc.).`
              },
              {
                role: "user",
                content: `Budget: $${dollars} or less. Location: ${userLocation}. Suggest fun, doable things right now or this weekend.`
              }
            ],
            temperature: 0.92,
            max_tokens: 320
          })
        });

        if (!response.ok) {
          throw new Error(`Proxy / API error: ${response.status}`);
        }

        const data = await response.json();
        let reply = data.choices?.[0]?.message?.content?.trim() || "Hmm... the vibes are quiet today üòÖ";

        // Basic markdown ‚Üí HTML conversion for better display
        reply = reply.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

        resultDiv.innerHTML = reply;

      } catch (err) {
        console.error(err);
        resultDiv.innerHTML = `Oops ‚Äî something went wrong üò≠<br><br>
          <small>Error: ${err.message}<br>
          ‚Ä¢ Check Vercel logs for proxy issues<br>
          ‚Ä¢ Confirm XAI_API_KEY is set in Vercel env vars<br>
          ‚Ä¢ Make sure /api/proxy.js exists in your repo</small>`;
      }
    }
  </script>

</body>
</html>
