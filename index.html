<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Budget Vibes ‚Ä¢ $ ‚Üí Fun</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
      color: #f0f0ff;
      min-height: 100vh;
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
    }
    h1 {
      font-size: 3.2rem;
      margin: 0.4rem 0 1.2rem;
      background: linear-gradient(90deg, #a78bfa, #7dd3fc);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .input-area {
      display: flex;
      gap: 12px;
      margin: 1.5rem 0 2rem;
    }
    input {
      font-size: 2.1rem;
      width: 180px;
      padding: 0.6rem 1rem;
      border: 2px solid #6b7280;
      border-radius: 12px;
      background: #1e1b38;
      color: white;
      text-align: center;
    }
    button {
      font-size: 1.4rem;
      padding: 0.8rem 1.8rem;
      border: none;
      border-radius: 12px;
      background: #7c3aed;
      color: white;
      cursor: pointer;
      transition: all 0.2s;
    }
    button:hover { background: #9f7aea; transform: translateY(-2px); }
    
    #result {
      max-width: 620px;
      background: rgba(30, 27, 56, 0.7);
      backdrop-filter: blur(8px);
      padding: 1.8rem 2.2rem;
      border-radius: 16px;
      line-height: 1.6;
      font-size: 1.25rem;
      border: 1px solid #4b5563;
      min-height: 140px;
      white-space: pre-wrap;
    }
    
    .emoji { font-size: 1.8rem; margin-right: 0.4rem; }

    /* Mobile optimizations */
    @media (max-width: 600px) {
      body { padding: 1rem; }
      h1 { font-size: 2.5rem; }
      input { font-size: 1.8rem; width: 140px; }
      button { font-size: 1.2rem; padding: 0.6rem 1.4rem; }
      #result { font-size: 1.1rem; padding: 1.4rem 1.8rem; max-width: 100%; }
      .input-area { flex-direction: column; align-items: center; gap: 8px; }
    }
  </style>
</head>
<body>

  <h1>Budget Vibes</h1>
  <p style="opacity:0.8; margin-top:-0.8rem;">Turn any dollar amount into instant fun ideas</p>

  <div class="input-area">
    <input type="number" id="budget" placeholder="23" min="1" step="1" autofocus>
    <button onclick="generateIdeas()">Go!</button>
  </div>

  <div id="result">Enter an amount and see the magic ‚ú®</div>

  <script>
    const resultDiv = document.getElementById('result');
    const input = document.getElementById('budget');

    let userLocation = ''; // Global to store location

    input.addEventListener('keypress', e => {
      if (e.key === 'Enter') generateIdeas();
    });

    // Function to get user's location with reverse geocoding
    async function getUserLocation() {
      return new Promise((resolve) => {
        if (!navigator.geolocation) {
          resolve('');
          return;
        }

        navigator.geolocation.getCurrentPosition(async (pos) => {
          try {
            const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${pos.coords.latitude}&lon=${pos.coords.longitude}&zoom=10&addressdetails=1`);
            const data = await res.json();
            const city = data.address.city || data.address.town || data.address.village || '';
            const state = data.address.state || data.address.province || '';
            const country = data.address.country_code?.toUpperCase() || '';
            resolve(city ? `${city}, ${state} ${country}`.trim() : '');
          } catch (err) {
            resolve(''); // Fallback if fetch fails
          }
        }, (err) => {
          resolve(''); // User denied or error
        }, { timeout: 5000 });
      });
    }

    // Get location on page load (async, non-blocking)
    getUserLocation().then(loc => {
      userLocation = loc;
      console.log('Location detected:', userLocation); // For debugging
    });

    async function generateIdeas() {
      let dollars = parseInt(input.value) || 0;
      if (dollars < 1) {
        resultDiv.innerHTML = "üí∏ At least give me <strong>$1</strong> to work with...";
        return;
      }

      // If location not yet set, try to get it now
      if (!userLocation) {
        userLocation = await getUserLocation();
      }

      resultDiv.innerHTML = "Thinking fun thoughts... ‚è≥";

      try {
        const res = await fetch("https://api.x.ai/v1/chat/completions", {   // or openai / gemini / groq / etc
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer YOUR_XAI_API_KEY_HERE"
          },
          body: JSON.stringify({
            model: "grok-beta",           // or latest model name
            messages: [
              {
                role: "system",
                content: `You are a very fun, creative, slightly chaotic friend who turns any budget into exciting activities. 
                Use emojis. Be specific. Include 4‚Äì6 ideas. Sort from cheapest to most expensive within the budget.
                Sometimes throw in one mildly unhinged idea. If location is provided, tailor suggestions to that area or similar locales.`
              },
              {
                role: "user",
                content: `Budget: $${dollars}. Give me fun things I can do today or this weekend with exactly that amount or less. Location: ${userLocation || 'anywhere in the world'}.`
              }
            ],
            temperature: 0.9,
            max_tokens: 280
          })
        });

        const data = await res.json();
        const reply = data.choices?.[0]?.message?.content || "Hmm... the vibes are not vibing today üòÖ";

        resultDiv.innerHTML = reply.replace(/\n/g, "<br>");

      } catch (err) {
        resultDiv.innerHTML = "AI is taking a coffee break ‚òï<br>Try again or check your connection!";
      }
    }
  </script>

</body>
</html>
